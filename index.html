<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Branas</title>
  <link rel="stylesheet" href="./node_modules/@blueprintjs/core/dist/blueprint.css">
  <link rel="stylesheet" data-name="vs/editor/editor.main" href="./node_modules/monaco-editor/min/vs/editor/editor.main.css">
  <link rel="stylesheet" href="./style.css">
  <script src="./node_modules/mousetrap/mousetrap.min.js"></script>
</head>

<body>
  <div id="app">
    <div id="navbar"></div>
    <div id="content">
      <aside id="menu">
      </aside>
      <div id="editors">
        <div class="pt-tabs">
          <ul class="pt-tab-list" role="tablist">
            <li class="pt-tab" role="tab" aria-selected="true">Markup ⌘1</li>
            <li class="pt-tab" role="tab">Style ⌘2</li>
            <li class="pt-tab" role="tab">States ⌘3</li>
          </ul>
          <div class="pt-tab-panel" role="tabpanel">
            <div class="editor" id="markup"></div>
          </div>
          <div class="pt-tab-panel" role="tabpanel" aria-hidden="true">
            <div class="editor" id="style"></div>
          </div>
          <div class="pt-tab-panel" role="tabpanel" aria-hidden="true">
            <div class="editor" id="state"></div>
          </div>
        </div>
      </div>
      <div id="previews">
        <style id="previews-style"></style>
        <div id="previews-markup"></div>
      </div>
      <div id="output">
        <div>
          <div class="pt-select pt-minimal">
            <select>
              <option selected>React.js</option>
              <option value="1">Angular.js</option>
              <option value="2">Vue.js</option>
              <option value="3">Elm</option>
            </select>
          </div>
          <div class="pt-select pt-minimal">
            <select>
              <option selected>SCSS</option>
              <option value="1">CSS</option>
            </select>
          </div>
          <div class="pt-select pt-minimal">
            <select>
              <option selected>ES 2017</option>
              <option value="1">TypeScript</option>
              <option value="2">Flow</option>
            </select>
          </div>
        </div>
        <div class="editor" id="output-editor"></div>
      </div>
    </div>
  </div>
  <script>
    // Monaco uses a custom amd loader that over-rides node's require.
    // Keep a reference to node's require so we can restore it after executing the amd loader file.
    var nodeRequire = global.require;
  </script>
  <script src="./node_modules/monaco-editor/min/vs/loader.js"></script>
  <script>
    // Save Monaco's amd require and restore Node's require
    var amdRequire = global.require;
    global.require = nodeRequire;
  </script>

  <script>
    // require node modules before loader.js comes in
    var path = require('path')
    function uriFromPath(_path) {
      var pathName = path.resolve(_path).replace(/\\/g, '/')
      if (pathName.length > 0 && pathName.charAt(0) !== '/') {
        pathName = '/' + pathName
      }
      return encodeURI('file://' + pathName)
    }
    amdRequire.config({
      baseUrl: uriFromPath(path.join(__dirname, './node_modules/monaco-editor/min'))
    })
    // workaround monaco-css not understanding the environment
    self.module = undefined
    // workaround monaco-typescript not understanding the environment
    self.process.browser = true
    amdRequire(['vs/editor/editor.main'], function () {
      nodeRequire('./lib/renderer.js')
    })
  </script>
  <script>
    const overlay = document.createElement('div')
    overlay.style.backgroundColor = 'gray'
    overlay.style.opacity = 0.2
    overlay.style.pointerEvents = 'none'
    overlay.style.position = 'absolute'
    overlay.style.transition = 'transition: all 0.5s ease-out'
    overlay.style.zIndex = 2147483647

    const innerOverlay = document.createElement('div')
    innerOverlay.style.width = '10px'
    innerOverlay.style.height = '10px'
    innerOverlay.style.backgroundColor = 'black'

    overlay.appendChild(innerOverlay)
    document.body.appendChild(overlay)

    let clicked = false
    document.addEventListener('click', (e) => {
      clicked = true
      const rect = e.target.getBoundingClientRect()
      console.log('...', rect)
      const computed = window.getComputedStyle(e.target)

      const paddingLeft = parseFloat(computed.paddingLeft)
      const paddingRight = parseFloat(computed.paddingRight)
      const paddingTop = parseFloat(computed.paddingTop)
      const paddingBottom = parseFloat(computed.paddingBottom)

      const marginLeft = parseFloat(computed.marginLeft)
      const marginRight = parseFloat(computed.marginRight)
      const marginTop = parseFloat(computed.marginTop)
      const marginBottom = parseFloat(computed.marginBottom)

      console.log(paddingTop, marginTop)
      console.log((rect.top - marginTop) + 'px')
    })

    document.addEventListener('mousemove', (e) => {
      if (clicked) return
      const computed = window.getComputedStyle(e.target)
      const rect = e.target.getBoundingClientRect()

      const paddingLeft = parseFloat(computed.paddingLeft)
      const paddingRight = parseFloat(computed.paddingRight)
      const paddingTop = parseFloat(computed.paddingTop)
      const paddingBottom = parseFloat(computed.paddingBottom)

      const marginLeft = parseFloat(computed.marginLeft)
      const marginRight = parseFloat(computed.marginRight)
      const marginTop = parseFloat(computed.marginTop)
      const marginBottom = parseFloat(computed.marginBottom)

      overlay.style.top = (rect.top - marginTop) + 'px'
      overlay.style.left = (rect.left - marginLeft) + 'px'
      overlay.style.width = (rect.width + marginLeft + marginRight) + 'px'
      overlay.style.height = (rect.height + marginTop + marginBottom) + 'px'
      overlay.style.borderLeft = `${marginLeft}px solid yellow`
      overlay.style.borderRight = `${marginRight}px solid yellow`
      overlay.style.borderTop = `${marginTop}px solid yellow`
      overlay.style.borderBottom = `${marginBottom}px solid yellow`

      innerOverlay.style.marginLeft = `${paddingLeft}px`
      innerOverlay.style.marginTop = `${paddingTop}px`
      innerOverlay.style.width = (rect.width - paddingLeft - paddingRight) + 'px'
      innerOverlay.style.height = (rect.height - paddingTop - paddingBottom) + 'px'
    })
  </script>
</body>

</html>
